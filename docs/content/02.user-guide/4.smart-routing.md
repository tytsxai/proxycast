---
title: 智能路由
description: 配置请求路由规则
navigation:
  icon: i-heroicons-arrows-right-left
---

# 智能路由

智能路由允许你根据模型名称将请求定向到特定的 Provider。

## 模型映射

### 映射规则

将请求中的模型名称映射到实际的 Provider 和模型：

| 请求模型 | 目标 Provider | 目标模型 |
|----------|---------------|----------|
| `gpt-4` | Kiro Claude | `claude-sonnet-4-20250514` |
| `gpt-3.5-turbo` | Gemini CLI | `gemini-2.0-flash` |
| `claude-*` | Kiro Claude | 保持原样 |

### 配置映射

1. 进入 **智能路由** 页面
2. 点击 **添加规则**
3. 配置映射：

```yaml
# 示例配置
routes:
  - pattern: "gpt-4*"
    provider: kiro-claude
    model: claude-sonnet-4-20250514
  - pattern: "gpt-3.5*"
    provider: gemini-cli
    model: gemini-2.0-flash
```

## 规则语法

### 模式匹配

| 模式 | 说明 | 示例 |
|------|------|------|
| `exact` | 精确匹配 | `gpt-4` 只匹配 `gpt-4` |
| `prefix*` | 前缀匹配 | `gpt-4*` 匹配 `gpt-4`, `gpt-4-turbo` |
| `*suffix` | 后缀匹配 | `*-turbo` 匹配 `gpt-4-turbo` |
| `*contains*` | 包含匹配 | `*claude*` 匹配任何包含 claude 的模型 |

### 规则字段

| 字段 | 必填 | 说明 |
|------|------|------|
| pattern | ✅ | 模型名称匹配模式 |
| provider | ✅ | 目标 Provider |
| model | ❌ | 目标模型（不填则保持原样） |
| priority | ❌ | 规则优先级（默认 100） |
| enabled | ❌ | 是否启用（默认 true） |

## 优先级排序

### 规则优先级

- 数值越小优先级越高
- 相同优先级按添加顺序
- 第一个匹配的规则生效

### 示例

```yaml
routes:
  # 优先级 10：精确匹配优先
  - pattern: "gpt-4-turbo"
    provider: openai-custom
    priority: 10
  
  # 优先级 50：前缀匹配
  - pattern: "gpt-4*"
    provider: kiro-claude
    priority: 50
  
  # 优先级 100：默认规则
  - pattern: "*"
    provider: gemini-cli
    priority: 100
```

## 默认回退

### 无规则匹配时

当请求的模型不匹配任何规则时：

1. 使用默认 Provider
2. 保持原始模型名称
3. 如果默认 Provider 不支持该模型，返回错误

### 配置默认 Provider

```yaml
default:
  provider: kiro-claude
  fallback: true  # 启用回退
```

## Provider 选择

### 可用 Provider

| Provider | 标识 | 说明 |
|----------|------|------|
| Kiro Claude | `kiro-claude` | Kiro IDE 的 Claude |
| Gemini CLI | `gemini-cli` | Google Gemini |
| Qwen | `qwen` | 通义千问 |
| OpenAI Custom | `openai-custom` | 自定义 OpenAI |
| Claude Custom | `claude-custom` | 自定义 Claude |

### 多 Provider 负载均衡

同一规则可以指定多个 Provider：

```yaml
routes:
  - pattern: "gpt-4*"
    providers:
      - kiro-claude
      - claude-custom
    strategy: round-robin
```

## 测试路由

### 路由测试工具

1. 输入模型名称
2. 点击 **测试路由**
3. 查看匹配结果：
   - 匹配的规则
   - 目标 Provider
   - 目标模型
