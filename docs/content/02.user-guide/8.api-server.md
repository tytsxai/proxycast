---
title: API Server
description: 配置和管理 API 服务
navigation:
  icon: i-heroicons-server
---

# API Server

API Server 是 ProxyCast 的核心组件，提供 OpenAI/Claude 兼容的 API 端点。

## 服务器配置

### 基本配置

| 选项 | 默认值 | 说明 |
|------|--------|------|
| 主机地址 | `127.0.0.1` | 监听地址 |
| 端口 | `9090` | 监听端口 |
| API Key | 自动生成 | 访问密钥 |

### 配置步骤

1. 进入 **设置** > **API Server**
2. 修改配置选项
3. 点击 **保存**
4. 重启服务生效

### 监听地址

| 地址 | 说明 |
|------|------|
| `127.0.0.1` | 仅本机访问 |
| `0.0.0.0` | 允许局域网访问 |

::alert{type="warning"}
使用 `0.0.0.0` 时请确保配置了 API Key 认证。
::

## API 端点

### OpenAI 兼容端点

| 端点 | 方法 | 说明 |
|------|------|------|
| `/v1/chat/completions` | POST | 聊天补全 |
| `/v1/models` | GET | 模型列表 |
| `/v1/embeddings` | POST | 文本嵌入 |

### Claude 兼容端点

| 端点 | 方法 | 说明 |
|------|------|------|
| `/v1/messages` | POST | 消息 API |
| `/v1/messages/count_tokens` | POST | Token 计数 |

## 请求日志

### 日志查看

1. 进入 **监控中心**
2. 查看 **请求日志** 标签
3. 实时显示所有请求

### 日志内容

每条日志包含：

- 时间戳
- 请求方法和路径
- 请求模型
- 响应状态
- 响应时间
- Token 使用量

### 日志过滤

支持按以下条件过滤：

- 时间范围
- 状态码
- 模型名称
- Provider

## 访问控制

### API Key 认证

启用 API Key 认证：

1. 进入 **设置** > **API Server**
2. 开启 **启用认证**
3. 设置或生成 API Key
4. 保存配置

### 请求认证

请求时需要携带 API Key：

**OpenAI 格式:**
```bash
curl http://127.0.0.1:9090/v1/chat/completions \
  -H "Authorization: Bearer your-api-key" \
  -H "Content-Type: application/json" \
  -d '{"model": "gpt-4", "messages": [...]}'
```

**Claude 格式:**
```bash
curl http://127.0.0.1:9090/v1/messages \
  -H "x-api-key: your-api-key" \
  -H "anthropic-version: 2023-06-01" \
  -H "Content-Type: application/json" \
  -d '{"model": "claude-3-sonnet", "messages": [...]}'
```

### 多 API Key

支持配置多个 API Key：

```yaml
auth:
  keys:
    - name: "开发环境"
      key: "dev-key-xxx"
    - name: "生产环境"
      key: "prod-key-xxx"
```

## CORS 配置

### 跨域设置

| 选项 | 默认值 | 说明 |
|------|--------|------|
| 允许来源 | `*` | 允许的请求来源 |
| 允许方法 | `GET,POST,OPTIONS` | 允许的 HTTP 方法 |
| 允许头部 | `*` | 允许的请求头 |

### 配置示例

```yaml
cors:
  origins:
    - "http://localhost:3000"
    - "https://myapp.com"
  methods:
    - GET
    - POST
  headers:
    - Authorization
    - Content-Type
```

## 服务管理

### 启动/停止

- **启动**: 点击仪表盘的 **启动服务** 按钮
- **停止**: 点击 **停止服务** 按钮
- **重启**: 点击 **重启服务** 按钮

### 开机自启

1. 进入 **设置** > **通用**
2. 开启 **开机自动启动**
3. 开启 **启动时自动运行服务**
